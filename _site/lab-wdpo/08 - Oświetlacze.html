<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>08 - Oświetlacze</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="_static/github-markdown.css" />
  <link rel="stylesheet" href="_static/custom.css" />
  <link rel="icon" type="image/x-icon" href="_static/favicon.ico" />
  <script>
  MathJax = {
      tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
      fontCache: 'global'
      }
  };
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
<main class="markdown-body">
<header id="title-block-header">
<h1 class="title">08 - Oświetlacze</h1>
</header>
<h1 id="wprowadzenie-do-systemów-wizyjnych">Wprowadzenie do Systemów Wizyjnych</h1>
<h2 id="politechnika-poznańska-instytut-robotyki-i-inteligencji-maszynowej">Politechnika Poznańska, Instytut Robotyki i Inteligencji Maszynowej</h2>
<p align="center">
  <img width="180" height="180" src="_static/logo.svg">
</p>

<h2 id="ćwiczenie-laboratoryjne-8-oświetlenie"><strong>Ćwiczenie laboratoryjne 8: oświetlenie</strong></h2>
<p><a href="/lab-wdpo">Powrót do spisu treści ćwiczeń laboratoryjnych</a></p>
<h1 id="wstęp">Wstęp</h1>
<p>Dodatkowe i dostosowane do zadania oświetlenie jest częstym rozwiązaniem przy wykorzystywaniu systemów wizyjnych w obszarze przemysłowym (ang. <a href="https://en.wikipedia.org/wiki/Machine_vision">Machine Vision</a>). Zastosowanie odpowiedniego typu oświetlacza pozwala uzyskać z obrazu istotne informacje związane z zadaniami takimi, jak kontrola jakości, detekcja uszkodzeń, rozpoznawanie i klasyfikacja elementów, a także ich kształtów oraz konturów. Najczęściej wykorzystywanymi typami oświetlaczy są:</p>
<h3 id="pierścieniowe-ring-light">Pierścieniowe (ring light)</h3>
<img align="left" width="140" height="140" src="./_08 - Oświetlacze_readme_files/ring_light_schema.png">

<p>Zadaniem oświetlaczy typu pierścieniowego jest przede wszystkim inspekcja powierzchni płaskich z wykorzystaniem zjawiska odbicia rozproszonego (promień padający na powierzchnię jest rozpraszany pod wieloma kątami) co przekłada się na zastosowanie w kontroli jakości polegającej na wykrywaniu defektów na powierzchni (np. zarysowań).</p>
<p></br></br></p>
<h3 id="pierścieniowe-ciemnego-pola-dark-field-light">Pierścieniowe ciemnego pola (dark field light)</h3>
<img align="left" width="140" height="140" src="./_08 - Oświetlacze_readme_files/dark_field_schema.png">

<p>Oświetlacze tego typu poprzez zastosowanie światła emitowanego pod niewielkim kątem wykorzystywane są do wzmocnienia kontrastu pomiędzy cechami obiektu, występującymi na jego powierzchni, co ułatwia rozpoznanie poszczególnych występujących elementów. Zastosowaniem tego typu urządzeń jest detekcja krawędzi, konturów oraz występujących na powierzchni defektów.</p>
</br>

<h3 id="kopułkowe--tunelowe-dome--tunnel-light">Kopułkowe / tunelowe (dome / tunnel light)</h3>
<img align="left" width="140" height="140" src="./_08 - Oświetlacze_readme_files/dome_light_schema.png">

<p>Podstawową zaletą oświetlaczy kopułkowych jest zapewnienie bezcieniowego oświetlenia, które przydatne jest w rozwiązaniach z zakresu:</p>
<ul>
<li>inspekcji lustrzanych i rozpraszających światło obiektów,</li>
<li>optycznego rozpoznawania znaków (OCR),</li>
<li>kontroli etykiet oraz nadruków.</li>
</ul>
<h3 id="tylne-back-light">Tylne (back light)</h3>
<img align="left" width="140" height="140" src="./_08 - Oświetlacze_readme_files/back_light_schema.png">

<p>Głównym zadaniem oświetlaczy tego typu jest podkreślenie konturów płaskich obiektów co wykorzystywane jest przy precyzyjnych pomiarach takich jak:</p>
<ul>
<li>określanie zewnętrznych wymiarów obiektu,</li>
<li>detekcja elementów,</li>
<li>wykrywanie otworów.</li>
</ul>
<h3 id="współosiowe-coaxial-light">Współosiowe (coaxial light)</h3>
<img align="left" width="140" height="140" src="./_08 - Oświetlacze_readme_files/coaxial_light_schema.png">

<p>Zadaniem oświetlaczy współosiowych jest oświetlanie powierzchni odbijających światło w tym celu wykorzystują rozpraszacz wiązki lub zwierciadło półprzezroczyste zmieniające kierunek światła ze źródła tak, aby padało ono na obiekt równolegle do osi optycznej kamery. Ta technika stosowana jest do kontroli obwodów drukowanych (PCB), odblaskowych etykiet lub kontroli druku.</p>
</br>

<h3 id="rgb">RGB</h3>
<img align="left" width="140" height="140" src="./_08 - Oświetlacze_readme_files/rgb.png">

<p>Oświetlacze kolorowe (RGB) stosowane są zazwyczaj w momencie, gdy obrabiane przedmioty mają taki sam kształt i rozmiar, a rozróżnia je kolor.</p>
<p></br></br></br></p>
<p>Podczas zajęć wykorzystywane będą oświetlacze firmy <a href="https://www.latab.net/pl/index.html">LATAB</a>, oświetlacze RGB firmy Ulanzi oraz namiot bezcieniowy firmy Puluz.</p>
<p align="center">
  <img width="700" height="500" src="./_08 - Oświetlacze_readme_files/latab_box.jpg">
  <img width="350" height="500" src="./_08 - Oświetlacze_readme_files/oswietlacz_rgb.jpg">
  <img width="350" height="500" src="./_08 - Oświetlacze_readme_files/namiot_bezcieniowy.jpg">
</p>

<h1 id="zadanie-wstępne">Zadanie wstępne</h1>
<p>Zapoznaj się z zasadami obsługi sterownika oświetlaczy przemysłowych firmy LATAB i przetestuj dostępne oświetlacze.</p>
<h1 id="informacja-o-środowisku-wirtualnym">Informacja o środowisku wirtualnym</h1>
<p><strong>UWAGA</strong> Ta instrukcja wymaga systemu operacyjnego Ubuntu oraz zainstalowanych dodatkowych bibliotek (Tesseract OCR).</p>
<h1 id="zadania-do-samodzielnej-realizacji">Zadania do samodzielnej realizacji</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="im">import</span> cv2</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="kw">def</span> camera():</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>    <span class="co">&quot;&quot;&quot;Camera capture.&quot;&quot;&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>    cap <span class="op">=</span> cv2.VideoCapture(<span class="dv">2</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>        ret, frame <span class="op">=</span> cap.read()</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>        <span class="cf">if</span> <span class="kw">not</span> ret:</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;Cannot connect to the camera.&quot;</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>            <span class="cf">break</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>        cv2.imshow(<span class="st">&quot;camera capture&quot;</span>, frame)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>        <span class="cf">if</span> cv2.waitKey(<span class="dv">10</span>) <span class="op">==</span> <span class="bu">ord</span>(<span class="st">&#39;q&#39;</span>):</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>            <span class="cf">break</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>    camera()</span></code></pre></div>
<ol>
<li>Przy pomocy oświetlacza pierścieniowego ciemnego pola przygotuj aplikację do wykrywania krawędzi. W tym celu:</li>
</ol>
<ul>
<li>stwórz skrypt <code>dark_field_light.py</code>, do którego dodaj przedstawiony powyżej fragment kodu,</li>
<li>korzystając z algorytmu <a href="https://docs.opencv.org/4.5.0/da/d22/tutorial_py_canny.html">Canny'ego</a> wyświetl rezultat przedstawiający wykryte krawędzie na odczytanym z kamery obrazie,</li>
<li>dodaj suwaki (<a href="https://docs.opencv.org/4.5.0/d7/dfc/group__highgui.html#gaf78d2155d30b728fc413803745b67a9b">createTrackbar()</a>) tak, aby dynamicznie móc dobierać wartości progów algorytmu.</li>
</ul>
<p>Na rysunku poniżej przedstawiony został oświetlacz typu dark field oraz efekt końcowy działania algorytmu. Porównaj otrzymany rezultat z obrazem otrzymanym bez włączonego oświetlacza pierścieniowego ciemnego pola.</p>
<p align="center">
  <img width="250" height="300" src="./_08 - Oświetlacze_readme_files/dark_field_light.jpg">
  <img width="300" height="300" src="./_08 - Oświetlacze_readme_files/dark_field_result.png">
</p>

<ol start="2">
<li>Korzystając z oświetlenia tylengo przygotuj aplikację do detekcji otworów. W tym celu:</li>
</ol>
<ul>
<li>stwórz skrypt <code>back_light.py</code> i wykorzystaj przedstawiony powyżej fragment kodu,</li>
<li>korzystając z <a href="https://docs.opencv.org/4.5.0/d4/d70/tutorial_hough_circle.html">transformaty Hougha do wykrywania okręgów</a> zaimplementuj rozwiązanie pozwalające na wykrywanie otworów w analizowanym obrazie,</li>
<li>dodaj suwaki (<a href="https://docs.opencv.org/4.5.0/d7/dfc/group__highgui.html#gaf78d2155d30b728fc413803745b67a9b">createTrackbar()</a>), tak aby dostosowując minimalny oraz maksymalny zakres promienia wykryć wszystkie okręgi na zdjęciu.</li>
</ul>
<p>Poniższe rysunki przedstawiają dostępne oświetlacze tylne oraz oczekiwane rozwiązanie zadania.</p>
<p align="center">
  <img width="250" height="300" src="./_08 - Oświetlacze_readme_files/back_light1.jpg">
  <img width="250" height="300" src="./_08 - Oświetlacze_readme_files/back_light2.jpg">
</p>

<p align="center">
  <img width="250" height="300" src="./_08 - Oświetlacze_readme_files/hole_detection1.png">
  <img width="250" height="300" src="./_08 - Oświetlacze_readme_files/hole_detection2.png">
</p>

<ol start="3">
<li>Wykorzystując namiot bezcieniowy, oświetlacze RGB oraz plansze zbadaj wpływ zmiany barwy oświetlenia LED na wyjściowy obraz. Na zdjęciu w skali szarości wyróżnij każdą z barw oraz zanotuj wartości dla których odpowiednie znaczniki najlepiej się odróżniają. Poniższy przykład przedstawia rezultat wyróżniający barwę czerwoną (zdjęcia kolejno to: oryginał, obraz w skali szarości bez oświetlenia oraz przy odpowiednim oświetleniu).</li>
</ol>
<p align="center">
  <img width="300" height="225" src="./_08 - Oświetlacze_readme_files/circles_base_light_color.jpg">
  <img width="300" height="225" src="./_08 - Oświetlacze_readme_files/circles_base_light_grayscale.jpg">
  <img width="300" height="225" src="./_08 - Oświetlacze_readme_files/circles_red_light.jpg">
</p>

<h1 id="zadanie-dodatkowe">Zadanie dodatkowe</h1>
<p>Korzystając z przygotowanego skryptu <a href="https://drive.google.com/file/d/1z1UX0AUmLmwsuF-OOr4KfVDdXlYfRVmh/view?usp=sharing"><code>serial_numbers_recognition.py</code></a>, który zawiera w sobie implementację <a href="https://github.com/tesseract-ocr/tesseract">Tesseract OCR</a>, czyli silnika do optycznego rozpoznawania znaków, dobierz odpowiedni typ oświetlacza, który pozwoli na rozpoznawanie numerów seryjnych dostępnych na spodzie puszek po napojach. Poniżej przedstawione zostało porównanie podglądu spodu jednej z puszek bez wykorzystania dodatkowego oświetlacza oraz przy odpowiednim oświetleniu.</p>
<p align="center">
  <img width="400" height="300" src="./_08 - Oświetlacze_readme_files/can_without_lighting.png">
  <img width="400" height="300" src="./_08 - Oświetlacze_readme_files/can_with_lighting.png">
</p>

<p>Przykładowe wyniki dla detekcji numerów i cyfr wyglądają następująco:</p>
<img align="left" width="200" height="150" src="./_08 - Oświetlacze_readme_files/can_with_lighting_and_detections.png">

</br>

<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="ex">Detected</span> text:</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>[<span class="st">&#39;24&#39;</span>, <span class="st">&#39;122021&#39;</span>, <span class="st">&#39;2&#39;</span>]</span></code></pre></div>
<p></br></br></p>
<img align="left" width="200" height="150" src="./_08 - Oświetlacze_readme_files/can2_with_lighting_and_detections.png">

</br>

<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="ex">Detected</span> text:</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>[<span class="st">&#39;.5.202421&#39;</span>, <span class="st">&#39;23.09.&#39;</span>]</span></code></pre></div>
</main>
</body>
</html>
