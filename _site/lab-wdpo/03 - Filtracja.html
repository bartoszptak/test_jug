<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>03 - Filtracja</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <link rel="stylesheet" href="_static/github-markdown.css" />
  <link rel="stylesheet" href="_static/custom.css" />
  <link rel="icon" type="image/x-icon" href="_static/favicon.ico" />
  <script>
  MathJax = {
      tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
      fontCache: 'global'
      }
  };
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
<main class="markdown-body">
<header id="title-block-header">
<h1 class="title">03 - Filtracja</h1>
</header>
<h1 id="wprowadzenie-do-przetwarzania-obrazÃ³w">Wprowadzenie do przetwarzania obrazÃ³w</h1>
<h2 id="politechnika-poznaÅ„ska-instytut-robotyki-i-inteligencji-maszynowej">Politechnika PoznaÅ„ska, Instytut Robotyki i Inteligencji Maszynowej</h2>
<p align="center">
  <img width="180" height="180" src="_static/logo.svg">
</p>

<h2 id="Ä‡wiczenie-laboratoryjne-3-filtracja"><strong>Ä†wiczenie laboratoryjne 3: Filtracja</strong></h2>
<p><a href="/lab-wdpo">PowrÃ³t do spisu treÅ›ci Ä‡wiczeÅ„ laboratoryjnych</a></p>
<h2 id="ciekawostka---historia-zdjÄ™cia-lenna">Ciekawostka - historia zdjÄ™cia Lenna:</h2>
<p><a href="http://en.wikipedia.org/wiki/Lenna">http://en.wikipedia.org/wiki/Lenna</a></p>
<h2 id="filtracja-obrazÃ³w">Filtracja obrazÃ³w</h2>
<p>W przetwarzaniu obrazÃ³w wystÄ™pujÄ… dwa gÅ‚Ã³wne rodzaje szumu:</p>
<ul>
<li><p>Szum detektora - wynika z dyskretnej natury stosowanych przetwornikÃ³w, tj. faktu, Å¼e stosowane przyrzÄ…dy dziaÅ‚ajÄ… na zasadzie zliczania fotonÃ³w. Zazwyczaj przyjmuje siÄ™, Å¼e moÅ¼e byÄ‡ modelowany przez niezaleÅ¼ny od obiektu, addytywny szum o rozkÅ‚adzie normalnym z zerowÄ… wartoÅ›ciÄ… Å›redniÄ… i pewnÄ… wariancjÄ….</p></li>
<li><p>Szum "sÃ³l i pieprz" wynika gÅ‚Ã³wnie z bÅ‚Ä™dÃ³w transmisji. PoszczegÃ³lne piksele majÄ… ustawianÄ… albo wartoÅ›Ä‡ maksymalnÄ… ("sÃ³l") albo minimalnÄ… ("pieprz"). ZakÅ‚Ã³cona jest tylko czÄ™Å›Ä‡ pikseli obrazu, pozostaÅ‚e pozostajÄ… bez zmian.</p></li>
</ul>
<p>OperacjÄ…, ktÃ³ra moÅ¼e pozwoliÄ‡ na usuniÄ™cie szumu z obrazu jest <strong>operacja filtracji</strong>. Filtracja jest operacjÄ…, ktÃ³ra bierze pod uwagÄ™ otoczenie (sÄ…siedztwo) piksela, dla ktÃ³rego jest wykonywana. Wszystkie elementy w jego sÄ…siedztwie sÄ… przemnaÅ¼ane przez odpowiadajÄ…ce im wspÃ³Å‚czynniki filtra, a suma tych wartoÅ›ci jest zapisywana jako zaktualizowana wartoÅ›Ä‡ piksela, ktÃ³ry byÅ‚ filtrowany. Jest to tzw. konwolucja 2D.</p>
<h3 id="liniowe-filtry-wygÅ‚adzajÄ…ce---filtr-uÅ›redniajÄ…cy">Liniowe filtry wygÅ‚adzajÄ…ce - filtr uÅ›redniajÄ…cy</h3>
<p>Najprostszym sposobem usuniÄ™cia szumu, ktÃ³ry rÃ³wnomiernie oscyluje pod i nad â€˜prawdziwÄ…â€™ wartoÅ›ciÄ… funkcji obrazowej jest lokalne uÅ›rednianie po pewnym obszarze. UÅ›rednianie moÅ¼e byÄ‡ realizowane przy wykorzystaniu maski prostokÄ…tnej lub koÅ‚owej, np.:</p>
<p align="center">
  <img src="./_03 - Filtracja_readme_files/mean_filter.png" />
</p>

<p>Rezultatem splotu z takim filtrem bÄ™dzie obraz o mniejszym natÄ™Å¼eniu szumu, lecz rÃ³wnieÅ¼ o mniejszej ostroÅ›ci.</p>
<h3 id="liniowe-filtry-wygÅ‚adzajÄ…ce---filtr-gaussowski">Liniowe filtry wygÅ‚adzajÄ…ce - filtr gaussowski</h3>
<p>PoprawÄ™ jakoÅ›ci wygÅ‚adzania moÅ¼na uzyskaÄ‡ poprzez zastosowanie uÅ›redniania waÅ¼onego odlegÅ‚oÅ›ciÄ… od Å›rodka filtru. JednÄ… z takich metod jest filtracja wygÅ‚adzajÄ…cym filtrem gaussowskim. PoszczegÃ³lne elementy jÄ…dra filtru o rozmiarze $2k + 1 Ã— 2k + 1$ sÄ… okreÅ›lane zgodnie ze wzorem:</p>
<p>$$ H(i, j)= \frac{1}{2 \pi \sigma ^ {2}} \exp - \Bigg( \frac{(i-k-1) ^ {2} + (j-k-1) ^ {2}}{2 \sigma ^ {2}} \Bigg) $$</p>
<p>Rezultat filtracji zaleÅ¼y od wybranego $\sigma$ :</p>
<ul>
<li>maÅ‚e odchylenie standardowe sprawi, Å¼e efekt wygÅ‚adzania bÄ™dzie niezauwaÅ¼alny - wagi oddalone od Å›rodka jÄ…dra bÄ™dÄ… niewielkie</li>
<li>wiÄ™ksze odchylenie sprawi, Å¼e wagi oddalone od Å›rodka przyjmÄ… wiÄ™ksze wartoÅ›ci, a rezultat bÄ™dzie dÄ…Å¼yÅ‚ do Å›redniej z sÄ…siedztwa, w efekcie szum zostanie w duÅ¼ej mierze zniwelowany, lecz obraz ulegnie rozmyciu</li>
<li>bardzo duÅ¼e odchylenie sprawi, Å¼e wiele szczegÃ³Å‚Ã³w obrazu zostanie usuniÄ™tych razem z szumem</li>
</ul>
<h3 id="nieliniowe-filtry-wygÅ‚adzajÄ…ce---filtr-medianowy">Nieliniowe filtry wygÅ‚adzajÄ…ce - filtr medianowy</h3>
<p>PodstawowÄ… wadÄ… filtrÃ³w liniowych jest rozmywanie krawÄ™dzi na obrazie. Aby tego uniknÄ…Ä‡ konieczne jest zastosowanie filtrÃ³w nieliniowych. Jednym z takich filtrÃ³w jest filtr medianowy. Zastosowanie tego filtru polega na przypisaniu pikselowi wartoÅ›ci bÄ™dÄ…cej medianÄ… w pewnym sÄ…siedztwie. Filtr ten nadaje siÄ™ szczegÃ³lnie do usuwania niewielkich artefaktÃ³w (np. szumu "pieprz i sÃ³l").</p>
<blockquote>
<p><strong>Uwaga:</strong><br />
W OpenCV powyÅ¼sze operacje filtrowania zostaÅ‚y zaimplementowane pod nazwami <code>cv2.blur()</code>, <code>cv2.medianBlur()</code> oraz <code>cv2.GaussianBlur()</code>. WiÄ™cej informacji znajdziesz w dokumentacji: <a href="https://docs.opencv.org/5.x/d4/d13/tutorial_py_filtering.html">https://docs.opencv.org/5.x/d4/d13/tutorial_py_filtering.html</a>.</p>
</blockquote>
<p><span class="emoji" data-emoji="boom">ğŸ’¥</span> <strong>Zadanie do wykonania</strong> <span class="emoji" data-emoji="boom">ğŸ’¥</span></p>
<ul>
<li><p>Pobierz dwa obrazy z wprowadzonymi zakÅ‚Ã³ceniami:</p>
<ul>
<li><p><a href="https://chmura.put.poznan.pl/s/witKUB1ChWPoMam">lenna_noise.bmp</a></p></li>
<li><p><a href="https://chmura.put.poznan.pl/s/O70eou5wNuEcMKX">lenna_salt_and_pepper.bmp</a></p></li>
</ul></li>
<li><p>WyÅ›wietl jeden z pobranych obrazÃ³w, a nastÄ™pnie korzystajÄ…c z poznanych funkcji do filtracji (filtr uÅ›redniajÄ…cy, filtr Gaussa, filtr medianowy) zaprezentuj ich dziaÅ‚anie. WyÅ›wietliÄ‡ rezultat dziaÅ‚ania kaÅ¼dego z filtrÃ³w w osobnym oknie w celu porÃ³wnania efektÃ³w filtracji.</p></li>
<li><p>Dodaj trackbar umoÅ¼liwiajÄ…cy sterowanie rozmiarem okna filtracji (wartoÅ›Ä‡ powinna byÄ‡ nieparzysta, wykorzystaj wzÃ³r na liczby nieparzyste <code>2n+1</code>).</p></li>
<li><p>Wykonaj filtracjÄ™ na obu obrazach z zakÅ‚Ã³ceniami. ZwrÃ³Ä‡ uwagÄ™ na efekty filtracji: w zaleÅ¼noÅ›ci od naniesionego szumu oraz rozmiaru okna filtracji.</p></li>
</ul>
<h2 id="operacje-morfologiczne">Operacje morfologiczne</h2>
<p><span class="emoji" data-emoji="boom">ğŸ’¥</span> <strong>Zadanie do wykonania</strong> <span class="emoji" data-emoji="boom">ğŸ’¥</span></p>
<p>Zapoznaj siÄ™ z operacjami morfologicznymi: <a href="https://docs.opencv.org/5.x/d9/d61/tutorial_py_morphological_ops.html">https://docs.opencv.org/5.x/d9/d61/tutorial_py_morphological_ops.html</a>. A nastÄ™pnie:</p>
<ul>
<li><p>WykorzystujÄ…c program z poprzednich zajÄ™Ä‡, ktÃ³ry wykonywaÅ‚ operacjÄ™ progowanie binarnego, wykonaj na obrazie binarnym jednÄ… z operacji <code>cv2.erode</code> lub <code>cv2.dilate</code>. WyÅ›wietl w osobnych oknach obraz po samej operacji progowania, a w osobnym obraz po progowaniu i operacji morfologicznej.</p></li>
<li><p>Dodaj trackbar, ktÃ³ry umoÅ¼liwia sterowanie rozmiarem maski wykorzystywanej w operacji morfologicznej. Zaobserwuj efekt jej zmiany.</p></li>
<li><p>Po przetestowaniu erozji i dylacji przetestuj otwarcie i domkniÄ™cie. ZastanÃ³w siÄ™, kiedy przydatna moÅ¼e byÄ‡ operacja domkniÄ™cia, a kiedy otwarcia.</p></li>
</ul>
<h2 id="skanowanie-obrazu">Skanowanie obrazu</h2>
<p>OpenCV zawiera bardzo duÅ¼o gotowych, zoptymalizowanych funkcji operujÄ…cych na obrazach, jednak w niektÃ³rych, stosunkowo rzadkich, przypadkach niezbÄ™dne jest operowanie bezpoÅ›rednio na obrazie i jego pikselach. MoÅ¼na to zrealizowaÄ‡ korzystajÄ…c z pÄ™tli <code>for</code>. SzerokoÅ›Ä‡, wysokoÅ›Ä‡ oraz liczbÄ™ kanaÅ‚Ã³w (dla obrazÃ³w kolorowych) moÅ¼na uzyskaÄ‡ wywoÅ‚ujÄ…c wÅ‚asnoÅ›Ä‡ <code>shape</code>. NastÄ™pnie iterujemy po szerokoÅ›ci, wysokoÅ›ci i (ewentualnie) liczbie kanaÅ‚Ã³w.</p>
<p><span class="emoji" data-emoji="boom">ğŸ’¥</span> <strong>Zadanie do wykonania</strong> <span class="emoji" data-emoji="boom">ğŸ’¥</span></p>
<ul>
<li><p>Wczytaj dowolny obraz w skali szaroÅ›ci, korzystajÄ…c z pÄ™tli, przeiteruj po obrazie i co trzeci piksel w wierszu zamieÅ„ na biaÅ‚y (wartoÅ›Ä‡ 255).</p></li>
<li><p>Napisz program, ktÃ³ry wykona na powyÅ¼szym obrazie operacjÄ™ wygÅ‚adzania w oknie 3x3 w krokach:</p>
<ul>
<li>zsumuj wszystkie piksele z wiersza nad/pod oraz kolumny przed/po</li>
<li>podziel sumÄ™ przez liczbÄ™ pikseli (9).</li>
</ul>
<p>Program powinien pominÄ…Ä‡ pierwszy/ostatni wiersz oraz pierwszÄ…/ostatniÄ… kolumnÄ™.</p></li>
<li><p>PorÃ³wnaj czas wykonywania oraz jakoÅ›Ä‡ dziaÅ‚ania z wbudowanÄ… funkcjÄ… <code>cv2.blur(src, (3, 3))</code>.</p></li>
<li><p>PorÃ³wnaÄ‡ czas wykonania oraz jakoÅ›Ä‡ dziaÅ‚ania z realizacjÄ… uÅ›redniania za pomocÄ… funkcji <a href="https://docs.opencv.org/master/d4/d86/group__imgproc__filter.html#ga27c049795ce870216ddfb366086b5a04">cv2.filter2D</a>.</p></li>
</ul>
<h2 id="zadania-do-samodzielnej-realizacji">Zadania do samodzielnej realizacji</h2>
<p><span class="emoji" data-emoji="boom">ğŸ’¥</span> <strong>Zadanie do wykonania</strong> <span class="emoji" data-emoji="boom">ğŸ’¥</span></p>
<p>W powyÅ¼szym zadaniu, piksele "na obramowaniu" obrazu zostaÅ‚y pominiÄ™te. Zapoznaj siÄ™ z innymi sposobami przetwarzania pikseli na jego brzegach: <a href="https://docs.opencv.org/5.x/d2/de8/group__core__array.html#ga209f2f4869e304c82d07739337eae7c5">https://docs.opencv.org/5.x/d2/de8/group__core__array.html#ga209f2f4869e304c82d07739337eae7c5</a></p>
<p><span class="emoji" data-emoji="boom">ğŸ’¥</span> <strong>Zadanie do wykonania</strong> <span class="emoji" data-emoji="boom">ğŸ’¥</span></p>
<p>Napisz funkcjÄ™ implementujÄ…cÄ… filtr Kuwahary (do obliczeÅ„ dla wygody wykorzystaÄ‡ moÅ¼na funkcjÄ™ <code>meanStdDev</code>).</p>
<p><strong>Czym jest filtr Kuwahary?</strong> Jest on innym przykÅ‚adem filtru zachowujÄ…cego krawÄ™dzie. MoÅ¼e byÄ‡ on okreÅ›lony dla rÃ³Å¼nych ksztaÅ‚tÃ³w okna, jednak najczÄ™Å›ciej przyjmuje siÄ™ okno kwadratowe o dÅ‚ugoÅ›ci boku rÃ³wnej $2L + 1$ gdzie $L$ jest liczbÄ… caÅ‚kowitÄ…. Okno jest dzielone na 4 czÄ™Å›ci jak na rysunku:</p>
  <p align="center">
    <img src="./_03 - Filtracja_readme_files/kuwahara.png" />
  </p>

<p>Dla kaÅ¼dej czÄ™Å›ci okreÅ›lana jest wariancja i wartoÅ›Ä‡ Å›rednia. Pikselowi bazowemu (Å›rodkowemu) przypisywana jest wartoÅ›Ä‡ Å›rednia z obszaru o najmniejszej wariancji.</p>
</main>
</body>
</html>
